<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>QR Betalen â€“ Kassa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

  <h1>QR Betalen</h1>

  <input
    id="bedrag"
    type="number"
    placeholder="Bedrag in euro"
  >

  <br><br>

  <button id="toonQR">Toon QR</button>

  <p id="statusTekst"></p>

  <div id="qrcode"></div>

  <!-- QR library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

  <script>
    // ðŸ”´ VERVANG DIT DOOR JOUW ECHTE NETLIFY URL
    const baseUrl = "https://profound-bunny-c7b7b3.netlify.app/";

    document.getElementById("toonQR").addEventListener("click", async function () {
      const bedrag = document.getElementById("bedrag").value;

      if (!bedrag || bedrag <= 0) {
        alert("Vul een geldig bedrag in");
        return;
      }

      // unieke paymentId per betaling
      const paymentId = crypto.randomUUID();

      // status reset (open)
      document.getElementById("statusTekst").innerText =
        "Wachten op betaling...";

      // QR leegmaken
      const qrDiv = document.getElementById("qrcode");
      qrDiv.innerHTML = "";

      // betaal-URL maken
      const betaalUrl =
        baseUrl +
        "/betaal.html?bedrag=" +
        encodeURIComponent(bedrag) +
        "&paymentId=" +
        encodeURIComponent(paymentId);

      // QR genereren
      new QRCode(qrDiv, {
        text: betaalUrl,
        width: 200,
        height: 200
      });

      // status polling (wordt in 3.2B echt gekoppeld)
      setInterval(async () => {
        const response = await fetch(
          "/.netlify/functions/status-get?paymentId=" + paymentId
        );
        const data = await response.json();

        if (data.status === "paid") {
          document.getElementById("statusTekst").innerText = "Betaald";
        }
      }, 1500);
    });
  </script>

</body>
</html>
